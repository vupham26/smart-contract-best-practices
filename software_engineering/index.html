
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://github.com/ConsenSys/smart-contract-best-practices/software_engineering/">
      
      
        <meta name="author" content="ConsenSys">
      
      
        <link rel="shortcut icon" href="../images/favicon.ico">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.3">
    
    
      
        <title>Software Engineering Techniques - Ethereum Smart Contract Best Practices</title>
      
    
    
      <script src="../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-9011e2d3f8.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
  </head>
  
  
  
  
    <body>
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Ethereum Smart Contract Best Practices" class="md-header-nav__button md-logo">
          
            <i class="md-icon md-icon--home"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Software Engineering Techniques
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        <i class="md-icon md-icon--home"></i>
      
    </div>
    Ethereum Smart Contract Best Practices
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/ConsenSys/smart-contract-best-practices" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../general_philosophy/" title="General Philosophy" class="md-nav__link">
      General Philosophy
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../recommendations/" title="Recommendations for Smart Contract Security in Solidity" class="md-nav__link">
      Recommendations for Smart Contract Security in Solidity
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../known_attacks/" title="Known Attacks" class="md-nav__link">
      Known Attacks
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Software Engineering Techniques
      </label>
    
    <a href="./" title="Software Engineering Techniques" class="md-nav__link md-nav__link--active">
      Software Engineering Techniques
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#upgrading-broken-contracts" title="Upgrading Broken Contracts" class="md-nav__link">
    Upgrading Broken Contracts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-breakers-pause-contract-functionality" title="Circuit Breakers (Pause contract functionality)" class="md-nav__link">
    Circuit Breakers (Pause contract functionality)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#speed-bumps-delay-contract-actions" title="Speed Bumps (Delay contract actions)" class="md-nav__link">
    Speed Bumps (Delay contract actions)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting" title="Rate Limiting" class="md-nav__link">
    Rate Limiting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-rollout" title="Contract Rollout" class="md-nav__link">
    Contract Rollout
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-deprecation" title="Automatic Deprecation" class="md-nav__link">
    Automatic Deprecation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restrict-amount-of-ether-per-usercontract" title="Restrict amount of Ether per user/contract" class="md-nav__link">
    Restrict amount of Ether per user/contract
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bug-bounty-programs" title="Bug Bounty Programs" class="md-nav__link">
    Bug Bounty Programs
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../documentation_procedures/" title="Documentation and Procedures" class="md-nav__link">
      Documentation and Procedures
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_tools/" title="Security Tools" class="md-nav__link">
      Security Tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../security_notifications/" title="Security Notifications" class="md-nav__link">
      Security Notifications
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../future_improvements/" title="Future improvements" class="md-nav__link">
      Future improvements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../bibliography/" title="Smart Contract Security Bibliography" class="md-nav__link">
      Smart Contract Security Bibliography
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      About
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        About
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../about/reviewers/" title="Reviewers" class="md-nav__link">
      Reviewers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../about/contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#upgrading-broken-contracts" title="Upgrading Broken Contracts" class="md-nav__link">
    Upgrading Broken Contracts
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#circuit-breakers-pause-contract-functionality" title="Circuit Breakers (Pause contract functionality)" class="md-nav__link">
    Circuit Breakers (Pause contract functionality)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#speed-bumps-delay-contract-actions" title="Speed Bumps (Delay contract actions)" class="md-nav__link">
    Speed Bumps (Delay contract actions)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rate-limiting" title="Rate Limiting" class="md-nav__link">
    Rate Limiting
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-rollout" title="Contract Rollout" class="md-nav__link">
    Contract Rollout
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#automatic-deprecation" title="Automatic Deprecation" class="md-nav__link">
    Automatic Deprecation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restrict-amount-of-ether-per-usercontract" title="Restrict amount of Ether per user/contract" class="md-nav__link">
    Restrict amount of Ether per user/contract
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bug-bounty-programs" title="Bug Bounty Programs" class="md-nav__link">
    Bug Bounty Programs
  </a>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ConsenSys/smart-contract-best-practices/edit/master/docs/software_engineering.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                  <h1>Software Engineering Techniques</h1>
                
                <p>As we discussed in the <a href="#general-philosophy">General Philosophy</a> section, it is not enough to protect yourself against the known attacks. Since the cost of failure on a blockchain can be very high, you must also adapt the way you write software, to account for that risk.</p>
<p>The approach we advocate is to "prepare for failure". It is impossible to know in advance whether your code is secure. However, you can architect your contracts in a way that allows them to fail gracefully, and with minimal damage. This section presents a variety of techniques that will help you prepare for failure.</p>
<p>Note: There's always a risk when you add a new component to your system. A badly designed fail-safe could itself become a vulnerability - as can the interaction between a number of well designed fail-safes. Be thoughtful about each technique you use in your contracts, and consider carefully how they work together to create a robust system.</p>
<h3 id="upgrading-broken-contracts">Upgrading Broken Contracts<a class="headerlink" href="#upgrading-broken-contracts" title="Permanent link">&para;</a></h3>
<p>Code will need to be changed if errors are discovered or if improvements need to be made. It is no good to discover a bug, but have no way to deal with it.</p>
<p>Designing an effective upgrade system for smart contracts is an area of active research, and we won't be able to cover all of the complications in this document. However, there are two basic approaches that are most commonly used. The simpler of the two is to have a registry contract that holds the address of the latest version of the contract. A more seamless approach for contract users is to have a contract that forwards calls and data onto the latest version of the contract.</p>
<p>Whatever the technique, it's important to have modularization and good separation between components, so that code changes do not break functionality, orphan data, or require substantial costs to port. In particular, it is usually beneficial to separate complex logic from your data storage, so that you do not have to recreate all of the data in order to change the functionality.</p>
<p>It's also critical to have a secure way for parties to decide to upgrade the code. Depending on your contract, code changes may need to be approved by a single trusted party, a group of members, or a vote of the full set of stakeholders. If this process can take some time, you will want to consider if there are other ways to react more quickly in case of an attack, such as an <a href="https://github.com/ConsenSys/smart-contract-best-practices/#circuit-breakers-pause-contract-functionality">emergency stop or circuit-breaker</a>.</p>
<p><strong>Example 1: Use a registry contract to store latest version of a contract</strong></p>
<p>In this example, the calls aren't forwarded, so users should fetch the current address each time before interacting with it.</p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">SomeRegister</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="n">backendContract</span><span class="p">;</span>
    <span class="kt">address</span><span class="p">[]</span> <span class="n">previousBackends</span><span class="p">;</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">function</span> <span class="n">SomeRegister</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="n">onlyOwner</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">)</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changeBackend</span><span class="p">(</span><span class="kt">address</span> <span class="n">newBackend</span><span class="p">)</span> <span class="kr">public</span>
    <span class="n">onlyOwner</span><span class="p">()</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">newBackend</span> <span class="o">!=</span> <span class="n">backendContract</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">previousBackends</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">backendContract</span><span class="p">);</span>
            <span class="n">backendContract</span> <span class="o">=</span> <span class="n">newBackend</span><span class="p">;</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>There are two main disadvantages to this approach:</p>
<ol>
<li>Users must always look up the current address, and anyone who fails to do so risks using an old version of the contract</li>
<li>You will need to think carefully about how to deal with the contract data when you replace the contract</li>
</ol>
<p>The alternate approach is to have a contract forward calls and data to the latest version of the contract:</p>
<p><strong>Example 2: <a href="http://ethereum.stackexchange.com/questions/2404/upgradeable-contracts">Use a <code>DELEGATECALL</code></a> to forward data and calls</strong></p>
<div class="highlight"><pre><span></span><span class="kd">contract</span> <span class="n">Relay</span> <span class="p">{</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">currentVersion</span><span class="p">;</span>
    <span class="kt">address</span> <span class="kr">public</span> <span class="n">owner</span><span class="p">;</span>

    <span class="kd">modifier</span> <span class="n">onlyOwner</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
        <span class="kr">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">Relay</span><span class="p">(</span><span class="kt">address</span> <span class="n">initAddr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">currentVersion</span> <span class="o">=</span> <span class="n">initAddr</span><span class="p">;</span>
        <span class="n">owner</span> <span class="o">=</span> <span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">;</span> <span class="c1">// this owner may be another contract with multisig, not a single contract owner</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="n">changeContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">newVersion</span><span class="p">)</span> <span class="kr">public</span>
    <span class="n">onlyOwner</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">currentVersion</span> <span class="o">=</span> <span class="n">newVersion</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">currentVersion</span><span class="p">.</span><span class="nb">delegatecall</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="n">data</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>This approach avoids the previous problems but has problems of its own. You must be extremely careful with how you store data in this contract. If your new contract has a different storage layout than the first, your data may end up corrupted. Additionally, this simple version of the pattern cannot return values from functions, only forward them, which limits its applicability. (<a href="https://github.com/ownage-ltd/ether-router">More complex implementations</a> attempt to solve this with in-line assembly code and a registry of return sizes.)</p>
<p>Regardless of your approach, it is important to have some way to upgrade your contracts, or they will become unusable when the inevitable bugs are discovered in them.</p>
<h3 id="circuit-breakers-pause-contract-functionality">Circuit Breakers (Pause contract functionality)<a class="headerlink" href="#circuit-breakers-pause-contract-functionality" title="Permanent link">&para;</a></h3>
<p>Circuit breakers stop execution if certain conditions are met, and can be useful when new errors are discovered. For example, most actions may be suspended in a contract if a bug is discovered, and the only action now active is a withdrawal. You can either give certain trusted parties the ability to trigger the circuit breaker or else have programmatic rules that automatically trigger the certain breaker when certain conditions are met.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="kr">private</span> <span class="n">stopped</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="kt">address</span> <span class="kr">private</span> <span class="n">owner</span><span class="p">;</span>

<span class="kd">modifier</span> <span class="n">isAdmin</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span> <span class="o">==</span> <span class="n">owner</span><span class="p">);</span>
    <span class="kr">_</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">toggleContractActive</span><span class="p">()</span> <span class="n">isAdmin</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// You can add an additional modifier that restricts stopping a contract to be based on another action, such as a vote of users</span>
    <span class="n">stopped</span> <span class="o">=</span> <span class="o">!</span><span class="n">stopped</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">modifier</span> <span class="n">stopInEmergency</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">stopped</span><span class="p">)</span> <span class="kr">_</span><span class="p">;</span> <span class="p">}</span>
<span class="kd">modifier</span> <span class="n">onlyInEmergency</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="n">stopped</span><span class="p">)</span> <span class="kr">_</span><span class="p">;</span> <span class="p">}</span>

<span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="n">stopInEmergency</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// some code</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="n">onlyInEmergency</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// some code</span>
<span class="p">}</span>
</pre></div>

<h3 id="speed-bumps-delay-contract-actions">Speed Bumps (Delay contract actions)<a class="headerlink" href="#speed-bumps-delay-contract-actions" title="Permanent link">&para;</a></h3>
<p>Speed bumps slow down actions, so that if malicious actions occur, there is time to recover. For example, <a href="https://github.com/slockit/DAO/">The DAO</a> required 27 days between a successful request to split the DAO and the ability to do so. This ensured the funds were kept within the contract, increasing the likelihood of recovery. In the case of the DAO, there was no effective action that could be taken during the time given by the speed bump, but in combination with our other techniques, they can be quite effective.</p>
<p>Example:</p>
<div class="highlight"><pre><span></span><span class="kd">struct</span> <span class="n">RequestedWithdrawal</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="n">amount</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="n">time</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="kr">private</span> <span class="n">balances</span><span class="p">;</span>
<span class="kd">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="n">RequestedWithdrawal</span><span class="p">)</span> <span class="kr">private</span> <span class="n">requestedWithdrawals</span><span class="p">;</span>
<span class="kt">uint</span> <span class="kr">constant</span> <span class="n">withdrawalWaitPeriod</span> <span class="o">=</span> <span class="mi">28</span> <span class="kc">days</span><span class="p">;</span> <span class="c1">// 4 weeks</span>

<span class="kd">function</span> <span class="n">requestWithdrawal</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">];</span>
        <span class="n">balances</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// for simplicity, we withdraw everything;</span>
        <span class="c1">// presumably, the deposit function prevents new deposits when withdrawals are in progress</span>

        <span class="n">requestedWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestedWithdrawal</span><span class="p">({</span>
            <span class="n">amount</span><span class="o">:</span> <span class="n">amountToWithdraw</span><span class="p">,</span>
            <span class="n">time</span><span class="o">:</span> <span class="nb">now</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="n">requestedWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nb">now</span> <span class="o">&gt;</span> <span class="n">requestedWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">time</span> <span class="o">+</span> <span class="n">withdrawalWaitPeriod</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">amountToWithdraw</span> <span class="o">=</span> <span class="n">requestedWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span><span class="p">;</span>
        <span class="n">requestedWithdrawals</span><span class="p">[</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">].</span><span class="n">amount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="nb">require</span><span class="p">(</span><span class="nb">msg</span><span class="p">.</span><span class="nb">sender</span><span class="p">.</span><span class="nb">send</span><span class="p">(</span><span class="n">amountToWithdraw</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h3 id="rate-limiting">Rate Limiting<a class="headerlink" href="#rate-limiting" title="Permanent link">&para;</a></h3>
<p>Rate limiting halts or requires approval for substantial changes. For example, a depositor may only be allowed to withdraw a certain amount or percentage of total deposits over a certain time period (e.g., max 100 ether over 1 day) - additional withdrawals in that time period may fail or require some sort of special approval. Or the rate limit could be at the contract level, with only a certain amount of tokens issued by the contract over a time period.</p>
<p><a href="https://gist.github.com/PeterBorah/110c331dca7d23236f80e69c83a9d58c#file-circuitbreaker-sol">Example</a></p>
<h3 id="contract-rollout">Contract Rollout<a class="headerlink" href="#contract-rollout" title="Permanent link">&para;</a></h3>
<p>Contracts should have a substantial and prolonged testing period - before substantial money is put at risk.</p>
<p>At minimum, you should:</p>
<ul>
<li>Have a full test suite with 100% test coverage (or close to it)</li>
<li>Deploy on your own testnet</li>
<li>Deploy on the public testnet with substantial testing and bug bounties</li>
<li>Exhaustive testing should allow various players to interact with the contract at volume</li>
<li>Deploy on the mainnet in beta, with limits to the amount at risk</li>
</ul>
<h5 id="automatic-deprecation">Automatic Deprecation<a class="headerlink" href="#automatic-deprecation" title="Permanent link">&para;</a></h5>
<p>During testing, you can force an automatic deprecation by preventing any actions, after a certain time period. For example, an alpha contract may work for several weeks and then automatically shut down all actions, except for the final withdrawal.</p>
<div class="highlight"><pre><span></span><span class="kd">modifier</span> <span class="n">isActive</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="nb">block</span><span class="p">.</span><span class="n">number</span> <span class="o">&lt;=</span> <span class="n">SOME_BLOCK_NUMBER</span><span class="p">);</span>
    <span class="kr">_</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">deposit</span><span class="p">()</span> <span class="kr">public</span> <span class="n">isActive</span> <span class="p">{</span>
    <span class="c1">// some code</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="n">withdraw</span><span class="p">()</span> <span class="kr">public</span> <span class="p">{</span>
    <span class="c1">// some code</span>
<span class="p">}</span>
</pre></div>

<h5 id="restrict-amount-of-ether-per-usercontract">Restrict amount of Ether per user/contract<a class="headerlink" href="#restrict-amount-of-ether-per-usercontract" title="Permanent link">&para;</a></h5>
<p>In the early stages, you can restrict the amount of Ether for any user (or for the entire contract) - reducing the risk.</p>
<h3 id="bug-bounty-programs">Bug Bounty Programs<a class="headerlink" href="#bug-bounty-programs" title="Permanent link">&para;</a></h3>
<p>Some tips for running bounty programs:</p>
<ul>
<li>Decide which currency bounties will be distributed in (BTC and/or ETH)</li>
<li>Decide on an estimated total budget for bounty rewards</li>
<li>From the budget, determine three tiers of rewards:</li>
<li>smallest reward you are willing to give out</li>
<li>highest reward that's usually awardable</li>
<li>an extra range to be awarded in case of very severe vulnerabilities</li>
<li>Determine who the bounty judges are (3 may be ideal typically)</li>
<li>Lead developer should probably be one of the bounty judges</li>
<li>When a bug report is received, the lead developer, with advice from judges, should evaluate the severity of the bug</li>
<li>Work at this stage should be in a private repo, and the issue filed on Github</li>
<li>If it's a bug that should be fixed, in the private repo, a developer should write a test case, which should fail and thus confirm the bug</li>
<li>Developer should implement the fix and ensure the test now passes; writing additional tests as needed</li>
<li>Show the bounty hunter the fix; merge the fix back to the public repo is one way</li>
<li>Determine if bounty hunter has any other feedback about the fix</li>
<li>Bounty judges determine the size of the reward, based on their evaluation of both the <em>likelihood</em> and <em>impact</em> of the bug.</li>
<li>Keep bounty participants informed throughout the process, and then strive to avoid delays in sending them their reward</li>
</ul>
<p>For an example of the three tiers of rewards, see <a href="https://bounty.ethereum.org">Ethereum's Bounty Program</a>:</p>
<blockquote>
<p>The value of rewards paid out will vary depending on severity of impact. Rewards for minor 'harmless' bugs start at 0.05 BTC. Major bugs, for example leading to consensus issues, will be rewarded up to 5 BTC. Much higher rewards are possible (up to 25 BTC) in case of very severe vulnerabilities.</p>
</blockquote>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../known_attacks/" title="Known Attacks" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Known Attacks
              </span>
            </div>
          </a>
        
        
          <a href="../documentation_procedures/" title="Documentation and Procedures" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Documentation and Procedures
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>